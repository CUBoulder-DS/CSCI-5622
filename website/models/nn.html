<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.521">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Machine Learning on Amazon Retail Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../models/pca.html" rel="next">
<link href="../models/dtrees.html" rel="prev">
<link href="../images/cover.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/cover.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Machine Learning on Amazon Retail Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/CUBoulder-DS/CSCI-5622"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="http://chocbanana.github.io/"> <i class="bi bi-person-circle" role="img">
</i> 
<span class="menu-text">By Bhavana</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../models/bayes.html">Models and Methods</a></li><li class="breadcrumb-item"><a href="../models/nn.html">Neural Networks</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Prep / EDA</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Models and Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Naive Bayes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/dtrees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Trees</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/nn.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PCA and SVD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models/svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SVM (Support Vector Machine)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conclusions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#neural-networks" id="toc-neural-networks" class="nav-link active" data-scroll-target="#neural-networks">Neural Networks</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#data-prep" id="toc-data-prep" class="nav-link" data-scroll-target="#data-prep">Data Prep</a></li>
  <li><a href="#model-selectiondefinition" id="toc-model-selectiondefinition" class="nav-link" data-scroll-target="#model-selectiondefinition">Model Selection/Definition</a></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#model-structure" id="toc-model-structure" class="nav-link" data-scroll-target="#model-structure">Model structure</a></li>
  <li><a href="#performance" id="toc-performance" class="nav-link" data-scroll-target="#performance">Performance</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">




<section id="neural-networks" class="level1">
<h1>Neural Networks</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<div style="width:100%;">
<div style="float:right; width:45%; padding:2%">
<p><a href="../images/nn.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="../images/nn.png" class="img-fluid"></a></p>
</div>
</div>
<p>Neural networks are machine learning models inspired by the brain’s neural structure, comprising interconnected neurons organized in layers. Input data enters the input layer, propagates through hidden layers where computations with weights and biases occur, and outputs are generated from the output layer. Activation functions introduce non-linearity, aiding in learning complex patterns. Training involves adjusting weights and biases via algorithms like backpropagation to minimize prediction errors using labeled data. Once trained, neural networks can make predictions on new data, excelling in tasks like image recognition and natural language processing due to their ability to extract features, adapt to domains, and achieve high performance. In general their use and complexity (both mathematical formulation and construction) have exploded in recent years, and are used heavily in massive AI/ML applications (such as the popular ChatGPT).</p>
<p>In this project, two simple neural networks will be trained; one in order to predict <code>Is Best Seller</code>, and another to predict the value of <code>Price Diff</code>, the change in product price over time.</p>
</section>
<section id="data-prep" class="level2">
<h2 class="anchored" data-anchor-id="data-prep">Data Prep</h2>
<p>The data is already clean with outliers removed and NaNs dealt with, but some more data engineering had to take place to make the features fit for running the models. The following transformations were done to the original (cleaned) dataset in order to make the 2 different input datasets:</p>
<div class="columns">
<div class="column">
<p><strong>Best Seller NN</strong></p>
<ul>
<li>Only select rows that contain a non-NaN value for <code>Category</code> and <code>Bought in Month</code></li>
<li>Select rows such that 1% of them are <code>Is Best Seller == True</code>. This is because the dataset contains more than &gt;1M rows, with only 0.4% of them <code>Is Best Seller == True</code>; this makes the prediction less biased and invariant for the model.</li>
<li>Make datetime binary, as there are only 2 values used for it anyways.</li>
<li>One-hot encode categorical var <code>Category</code></li>
</ul>
</div><div class="column">
<p><strong>Price Difference NN</strong></p>
<ul>
<li>Make DF of products that have a calculable price difference over time</li>
<li>Use initial price and data, in order to predict later price change</li>
<li>Only use data with <code>Category</code> categories that have more than 5 products occuring, to improve prediction</li>
<li>Scale numerical data to [0, 1], make bool <code>Is Best Seller</code> an int</li>
<li>One-hot encode categorical var <code>Category</code></li>
</ul>
</div>
</div>
<p>The data was also split into 25% test data, and 75% training data. It’s essential for the training and test data to be disjoint, meaning they should not overlap, to ensure the validity and accuracy of the model’s performance evaluation. Reasons for this include to avoid overfitting, assessing bias and variance, supporting reproducability and validation, and preventing data leakage.</p>
<p>A sample of the final form of the data used can be seen in <a href="#tbl-data" class="quarto-xref">Table&nbsp;1</a>. A link to the data used can be found <a href="https://github.com/CUBoulder-DS/CSCI-5622/blob/main/data/output/products_sample.csv">here</a>.</p>
<div id="tbl-data" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: The form of the final dataset used for each of the 2 models, without the one-hot encoded <code>Category</code> columns included. The training and test sets made from these data look exactly the same, except with differing number of observations.
</figcaption>
<div aria-describedby="tbl-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>Sample of input data, where <code>Is Best Seller</code> is the binary classification label to predict.</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 19%">
<col style="width: 23%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Stars</th>
<th style="text-align: right;">Reviews</th>
<th style="text-align: right;">Price</th>
<th style="text-align: right;">Date Scraped</th>
<th style="text-align: right;">Bought In Month</th>
<th style="text-align: right;">Is Best Seller</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">508</td>
<td style="text-align: right;">20.99</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">900</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">17.99</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">550</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">22.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34.52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>Sample of input data, where <code>Price Diff</code> is the continuous numerical label to predict.</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Is Best Seller</th>
<th style="text-align: right;">Stars</th>
<th style="text-align: right;">Reviews</th>
<th style="text-align: right;">Price</th>
<th style="text-align: right;">List Price</th>
<th style="text-align: right;">Bought In Month</th>
<th style="text-align: right;">Price Diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">5815</td>
<td style="text-align: right;">12.97</td>
<td style="text-align: right;">12.97</td>
<td style="text-align: right;">3000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: right;">2457</td>
<td style="text-align: right;">57.96</td>
<td style="text-align: right;">57.96</td>
<td style="text-align: right;">900</td>
<td style="text-align: right;">-11.95</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: right;">185</td>
<td style="text-align: right;">7.19</td>
<td style="text-align: right;">7.19</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">1.69</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">657</td>
<td style="text-align: right;">89.99</td>
<td style="text-align: right;">139.99</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">1907</td>
<td style="text-align: right;">8.97</td>
<td style="text-align: right;">12.95</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">-3.98</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">19.99</td>
<td style="text-align: right;">19.99</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">1783</td>
<td style="text-align: right;">21.99</td>
<td style="text-align: right;">21.99</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">668</td>
<td style="text-align: right;">244.95</td>
<td style="text-align: right;">244.95</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">37.05</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1615</td>
<td style="text-align: right;">211.94</td>
<td style="text-align: right;">211.94</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">32.15</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.24</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</section>
<section id="model-selectiondefinition" class="level2">
<h2 class="anchored" data-anchor-id="model-selectiondefinition">Model Selection/Definition</h2>
<p>There are a lot of hyperparameters (options of a model that must be set before training/fitting it) associated with neural networks. For both networks, 3 hidden layers were used, with a sigmoid activation function after each layer. They also both used the ADAM algorithm optimizer for performing the gradient descent, with default values for rate and tolerance. They differ in the following hyperparameters:</p>
<div class="columns">
<div class="column">
<p><strong>Best Seller NN</strong></p>
<ul>
<li>Input dimensions: 253 cols (including the one-hot encoded <code>Category</code> columns)</li>
<li>Epochs: 50, loss did not improve after that</li>
<li>Loss function: Cross-entropy loss with extra weight on the <code>True/1</code> class, in order to account for the imbalance and to properly get loss on the two binary classes.</li>
<li>Output: vector of dims <code>[batch size, 2]</code> where the 2 output values are the predicted probabilities for each class.</li>
<li>Batch size: 100, as there are more than &gt; 1M input observations.</li>
</ul>
</div><div class="column">
<p><strong>Price Difference NN</strong></p>
<ul>
<li>Input dimensions: 118 cols (including the one-hot encoded <code>Category</code> columns)</li>
<li>Epochs: 200, loss did not improve after that</li>
<li>Loss function: mean squared error (MSE) loss</li>
<li>Output: vector of dims <code>[batch size, 1]</code> where the output value is the predicted price difference</li>
<li>Batch size: 1, as there is only about a thousand training input observations.</li>
</ul>
</div>
</div>
<p>The final structure of the networks can be seen below in <a href="#results">Results</a>.</p>
</section>
<section id="code" class="level2">
<h2 class="anchored" data-anchor-id="code">Code</h2>
<div class="columns">
<div class="column">
<p>The jupyter notebook code for running the neural networks, data prep, and everything else on this page can be found <a href="https://github.com/CUBoulder-DS/CSCI-5622/blob/main/src/NN%20LM.ipynb">here</a>, or click on the link card to the right.</p>
</div><div class="column" style="width:10%;">
<!-- Spacing column -->
</div><div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github-link-card.s3.ap-northeast-1.amazonaws.com/CUBoulder-DS/CSCI-5622.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="model-structure" class="level3">
<h3 class="anchored" data-anchor-id="model-structure">Model structure</h3>
<p>The structures of each of the networks can be seen below in <a href="#fig-nns" class="quarto-xref">Figure&nbsp;1</a>. “Gemm” stands for General Matrix Multiplication, and represents the standard linear layer with weights B and bias C.</p>
<div id="fig-nns" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-figure quarto-figure-center quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="../images/nn_bs_structure.png" class="lightbox" data-description="" data-gallery="quarto-lightbox-gallery-3" title="The structure of the “Is Best Seller” NN"><img src="../images/nn_bs_structure.png" class="img-fluid figure-img"></a></p>
<figcaption>The structure of the “Is Best Seller” NN</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="../images/nn_pd_structure.png" class="lightbox" data-description="" data-gallery="quarto-lightbox-gallery-4" title="The structure of the “Price Diff” NN"><img src="../images/nn_pd_structure.png" class="img-fluid figure-img"></a></p>
<figcaption>The structure of the “Price Diff” NN</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The NN structures used
</figcaption>
</figure>
</div>
</section>
<section id="performance" class="level3">
<h3 class="anchored" data-anchor-id="performance">Performance</h3>
<p>The average loss found at each epoch of the training can be seen in <a href="#fig-loss" class="quarto-xref">Figure&nbsp;2</a>. As can be seen, both NNs improved over time and had a typical bottoming-out of improvement, though at different number of epochs. We can also observe that the validation loss (or the loss when checked against the test data at that time) varies wildly, with spikes in both plots. The Price Diff NN even has the validation loss being consistently lower than the training loss, which is unusual; it is more common to see it being higher based on the amount of overfitting happening.</p>
<div id="fig-loss" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-loss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-figure quarto-figure-center quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="../images/nn_bs_loss.png" class="lightbox" data-description="" data-gallery="quarto-lightbox-gallery-5" title="“Is Best Seller” NN"><img src="../images/nn_bs_loss.png" class="img-fluid figure-img"></a></p>
<figcaption>“Is Best Seller” NN</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="../images/nn_pd_loss.png" class="lightbox" data-description="" data-gallery="quarto-lightbox-gallery-6" title="“Price Diff” NN"><img src="../images/nn_pd_loss.png" class="img-fluid figure-img"></a></p>
<figcaption>“Price Diff” NN</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-loss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The loss plots over all training epochs
</figcaption>
</figure>
</div>
<p><strong>Best Seller NN</strong></p>
<div class="columns">
<div class="column">
<p>The performance metrics of the “Is Best Seller” NN can be seen in <a href="#tbl-pm" class="quarto-xref">Table&nbsp;2</a>. As we can see, the model actually achieved lower accuracy (95%) than would have been gotten from predicting everything to be the dominant class (which comprised 99% of the data); this was due to the loss function being weighted to be biased towards the smaller class <code>Is Best Seller=True</code>.</p>
<p>The confusion matrix can be seen in <a href="#fig-cm" class="quarto-xref">Figure&nbsp;3</a>. As we can see, many observations were predicted to be a FP (flase positive), which aligns with the earlier observation that the network was biased towards the smaller class.</p>
</div><div class="column">
<div id="tbl-pm" class="anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: The performance metrics of the “Is Best Seller” NN.
</figcaption>
<div aria-describedby="tbl-pm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">f1-score</th>
<th style="text-align: right;">support</th>
<th style="text-align: right;">accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Not Best Seller</td>
<td style="text-align: right;">0.998181</td>
<td style="text-align: right;">0.952533</td>
<td style="text-align: right;">0.974823</td>
<td style="text-align: right;">342237</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Is Best Seller</td>
<td style="text-align: right;">0.062067</td>
<td style="text-align: right;">0.644098</td>
<td style="text-align: right;">0.113223</td>
<td style="text-align: right;">1669</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">0.951036</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="fig-cm" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/nn_bs_cm.png" class="lightbox" data-description="Figure&nbsp;3: The confusion matrix of the “Is Best Seller” NN." data-gallery="quarto-lightbox-gallery-7"><img src="../images/nn_bs_cm.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The confusion matrix of the “Is Best Seller” NN.
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Price Difference NN</strong></p>
<div class="columns">
<div class="column">
<div id="fig-pd-diff" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pd-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/nn_pd_diff.png" class="lightbox" data-description="Figure&nbsp;4: The plot of the actual true price difference, visualized against how much of a difference the model’s predicted value was against the true value." data-gallery="quarto-lightbox-gallery-8"><img src="../images/nn_pd_diff.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pd-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: The plot of the actual true price difference, visualized against how much of a difference the model’s predicted value was against the true value.
</figcaption>
</figure>
</div>
</div><div class="column">
<p>As the model was fitting to a continuous label, there are no binary/classification report we can use; however, the overall MSE was <span class="math inline">\(6.056\)</span>.</p>
<p>In <a href="#fig-pd-diff" class="quarto-xref">Figure&nbsp;4</a>, we observe the plot of the actual true price difference, visualized against how much of a difference the model’s predicted value was against the true value. As we can see, the model di fairly well at getting near the true value for price diffs of around -$4.30 to $300; we can also see that the model did much better for negative values than for positive values. Additionally, as the true price differences become large, the model struggles to adjust and predict the large values.</p>
</div>
</div>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>From the above results, several interesting conclusions can be drawn:</p>
<p>The networks were able to learn and fit to the data, which was evident by the loss rate during training. They also performed better than other ML methods used in this project, on the same tasks. However, they did not perform amazingly; this seems like a lack in the amount of data (in the case of price difference prediction) or not predictive enough variables in the dataset (in the case of predicting best seller).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../models/dtrees.html" class="pagination-link  aria-label=" decision="" trees"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Decision Trees</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../models/pca.html" class="pagination-link" aria-label="PCA and SVD">
        <span class="nav-page-text">PCA and SVD</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","selector":".lightbox","closeEffect":"zoom","loop":false,"descPosition":"bottom"});</script>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>